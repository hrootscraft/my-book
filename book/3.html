
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>COMPARE F1 SCORES &#8212; My Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'book/3';</script>
    <link rel="canonical" href="https://hrootscraft.github.io/my-book/book/3.html" />
    <link rel="icon" href="../_static/fav.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Streamlit code" href="4.html" />
    <link rel="prev" title="EDA - Exploratory Data Anlaysis" href="2.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="My Book - Home"/>
    <img src="../_static/logo.png" class="logo__image only-dark pst-js-only" alt="My Book - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="markdown.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.html">Normalize Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.html">EDA - Exploratory Data Anlaysis</a></li>





<li class="toctree-l1 current active"><a class="current reference internal" href="#">COMPARE F1 SCORES</a></li>


<li class="toctree-l1"><a class="reference internal" href="4.html">Streamlit Code</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/hrootscraft/my-book/master?urlpath=tree/book/3.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/hrootscraft/my-book/blob/master/book/3.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/hrootscraft/my-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/hrootscraft/my-book/edit/main/book/3.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/hrootscraft/my-book/issues/new?title=Issue%20on%20page%20%2Fbook/3.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/book/3.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>COMPARE F1 SCORES</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">COMPARE F1 SCORES</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#save-the-best-model">SAVE THE BEST MODEL</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#use-fast-api-to-deploy-model">USE FAST API TO DEPLOY MODEL</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;normalized_data.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;ChurnLabel&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ChurnLabel&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>

<span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>

<span class="c1"># Encode target variable (&#39;No&#39; -&gt; 0, &#39;Yes&#39; -&gt; 1)</span>
<span class="n">y_encoded</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_encoded</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dagshub</span>

<span class="c1"># dagshub.init(repo_owner=&#39;hrootscraft&#39;, repo_name=&#39;my-book&#39;, mlflow=True)</span>
<span class="n">DAGSHUB_TOKEN</span> <span class="o">=</span> <span class="n">dagshub</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">get_token</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">dagshub</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1"># dagshub.init(repo_owner=&#39;hrootscraft&#39;, repo_name=&#39;my-book&#39;, mlflow=True)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">DAGSHUB_TOKEN</span> <span class="o">=</span> <span class="n">dagshub</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">get_token</span><span class="p">()</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;dagshub&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="k">class</span> <span class="nc">CustomPreprocessor</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span> <span class="s1">&#39;Latitude&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;Longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;ChurnScore&#39;</span><span class="p">,</span> <span class="s1">&#39;CLTV&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;ChurnReason&#39;</span><span class="p">,</span> <span class="s1">&#39;ZipCode&#39;</span><span class="p">,</span> <span class="s1">&#39;City&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TenureMonths&#39;</span><span class="p">,</span> <span class="s1">&#39;MonthlyCharges&#39;</span><span class="p">,</span> <span class="s1">&#39;TotalCharges&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">categorical_features</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Will be set during fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoded_feature_names</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_impute_total_charges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X_</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">X_</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;TotalCharges&#39;</span><span class="p">]):</span>
                <span class="n">X_</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;TotalCharges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">X_</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;MonthlyCharges&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X_</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;TenureMonths&#39;</span><span class="p">]</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">X_</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Set categorical features (excluding target)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span> 
                                   <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns_to_drop</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;ChurnLabel&#39;</span><span class="p">]]</span>
        
        <span class="n">X_</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">X_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_impute_total_charges</span><span class="p">(</span><span class="n">X_</span><span class="p">)</span>
        <span class="n">X_</span> <span class="o">=</span> <span class="n">X_</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">columns_to_drop</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="n">X_</span><span class="p">[</span><span class="s1">&#39;TotalCharges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">X_</span><span class="p">[</span><span class="s1">&#39;TotalCharges&#39;</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">numeric_features</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">categorical_features</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">encoded_feature_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">feature</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categorical_features</span><span class="p">):</span>
            <span class="n">feature_categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">categories_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encoded_feature_names</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cat</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">feature_categories</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X_</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">X_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_impute_total_charges</span><span class="p">(</span><span class="n">X_</span><span class="p">)</span>
        <span class="n">X_</span> <span class="o">=</span> <span class="n">X_</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">columns_to_drop</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="n">X_</span><span class="p">[</span><span class="s1">&#39;TotalCharges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">X_</span><span class="p">[</span><span class="s1">&#39;TotalCharges&#39;</span><span class="p">])</span>
        
        <span class="n">X_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">numeric_features</span><span class="p">]),</span>
            <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">numeric_features</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">X_</span><span class="o">.</span><span class="n">index</span>
        <span class="p">)</span>
        
        <span class="n">X_encoded</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">categorical_features</span><span class="p">]),</span>
            <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoded_feature_names</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">X_</span><span class="o">.</span><span class="n">index</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_scaled</span><span class="p">,</span> <span class="n">X_encoded</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">cross_validate</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>

<span class="c1"># Set MLflow tracking URI and credentials</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/hrootscraft/my-book.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MLFLOW_TRACKING_USERNAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;hrootscraft&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MLFLOW_TRACKING_PASSWORD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DAGSHUB_TOKEN</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;churn_prediction&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">train_logistic_regression</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">cv_folds</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trains and evaluates the model with cross-validation and hyperparameter tuning</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;logistic_regression&quot;</span><span class="p">):</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        
        <span class="c1"># Create pipeline</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">CustomPreprocessor</span><span class="p">()),</span>
            <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">())</span>
        <span class="p">])</span>
        
        <span class="c1"># Define parameter grid</span>
        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="mf">1e0</span><span class="p">,</span> <span class="mf">1e1</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">],</span>
            <span class="s1">&#39;classifier__solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;liblinear&#39;</span><span class="p">],</span>
            <span class="s1">&#39;classifier__class_weight&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;balanced&#39;</span><span class="p">]</span>
        <span class="p">}</span>
        
        <span class="c1"># Perform GridSearchCV</span>
        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
            <span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> 
            <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> 
            <span class="n">cv</span><span class="o">=</span><span class="n">cv_folds</span><span class="p">,</span> 
            <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> 
            <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        
        <span class="c1"># Fit the model</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        
        <span class="c1"># Log best parameters</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
        
        <span class="c1"># Perform cross-validation with best model</span>
        <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
            <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span>
            <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
            <span class="n">cv</span><span class="o">=</span><span class="n">cv_folds</span><span class="p">,</span>
            <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span>
            <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        
        <span class="c1"># Log cross-validation results</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;cv_f1_mean&quot;</span><span class="p">,</span> <span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;cv_f1_std&quot;</span><span class="p">,</span> <span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        
        <span class="c1"># Get predictions on test set</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        
        <span class="c1"># Calculate metrics</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        
        <span class="c1"># Log metrics</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;test_f1&quot;</span><span class="p">:</span> <span class="n">f1</span><span class="p">,</span>
            <span class="s2">&quot;true_negatives&quot;</span><span class="p">:</span> <span class="n">tn</span><span class="p">,</span>
            <span class="s2">&quot;false_positives&quot;</span><span class="p">:</span> <span class="n">fp</span><span class="p">,</span>
            <span class="s2">&quot;false_negatives&quot;</span><span class="p">:</span> <span class="n">fn</span><span class="p">,</span>
            <span class="s2">&quot;true_positives&quot;</span><span class="p">:</span> <span class="n">tp</span>
        <span class="p">}</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
        
        <span class="c1"># Log model</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
            <span class="n">sk_model</span><span class="o">=</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span>
            <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;churn_model&quot;</span><span class="p">,</span>
            <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
            <span class="n">input_example</span><span class="o">=</span><span class="n">X_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">registered_model_name</span><span class="o">=</span><span class="s2">&quot;LogisticRegression&quot;</span>
        <span class="p">)</span>
        
        <span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training completed in </span><span class="si">{</span><span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best parameters: </span><span class="si">{</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best CV f1-score: </span><span class="si">{</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test f1-score: </span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Confusion Matrix:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TN: </span><span class="si">{</span><span class="n">tn</span><span class="si">}</span><span class="s2">, FP: </span><span class="si">{</span><span class="n">fp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FN: </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">, TP: </span><span class="si">{</span><span class="n">tp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span> <span class="n">f1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">logi_model</span> <span class="o">=</span> <span class="n">train_logistic_regression</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 5 folds for each of 9 candidates, totalling 45 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/rutuja/miniconda3/envs/jupyterbook/lib/python3.10/site-packages/mlflow/types/utils.py:435: UserWarning: Hint: Inferred schema contains integer column(s). Integer columns in Python cannot represent missing values. If your input data contains missing values at inference time, it will be encoded as floats and will cause a schema enforcement error. The best way to avoid this problem is to infer the model schema based on a realistic data sample (training dataset) that includes missing values. Alternatively, you can declare integer columns as doubles (float64) whenever these columns may have missing values. See `Handling Integers With Missing Values &lt;https://www.mlflow.org/docs/latest/models.html#handling-integers-with-missing-values&gt;`_ for more details.
  warnings.warn(
Registered model &#39;LogisticRegression&#39; already exists. Creating a new version of this model...
2024/12/22 17:41:53 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: LogisticRegression, version 6
Created version &#39;6&#39; of model &#39;LogisticRegression&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training completed in 25.20 seconds
Best parameters: {&#39;classifier__C&#39;: 100.0, &#39;classifier__class_weight&#39;: &#39;balanced&#39;, &#39;classifier__solver&#39;: &#39;liblinear&#39;}
Best CV f1-score: 0.6498
Test f1-score: 0.6253

Confusion Matrix:
TN: 756, FP: 279
FN: 77, TP: 297
üèÉ View run logistic_regression at: https://dagshub.com/hrootscraft/my-book.mlflow/#/experiments/0/runs/e5d2f47bda584bf382ae944d0b661299
üß™ View experiment at: https://dagshub.com/hrootscraft/my-book.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train_ridge_classifier</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">cv_folds</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trains and evaluates Ridge Classifier with cross-validation and hyperparameter tuning</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;ridge_classifier&quot;</span><span class="p">):</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="c1"># Create pipeline</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">CustomPreprocessor</span><span class="p">()),</span>
            <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RidgeClassifier</span><span class="p">())</span>
        <span class="p">])</span>
        
        <span class="c1"># Define parameter grid</span>
        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;classifier__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span>
            <span class="s1">&#39;classifier__class_weight&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;balanced&#39;</span><span class="p">],</span>
            <span class="s1">&#39;classifier__solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;svd&#39;</span><span class="p">,</span> <span class="s1">&#39;cholesky&#39;</span><span class="p">]</span>
        <span class="p">}</span>
        
        <span class="c1"># Perform GridSearchCV</span>
        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
            <span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span>
            <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span>
            <span class="n">cv</span><span class="o">=</span><span class="n">cv_folds</span><span class="p">,</span>
            <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        
        <span class="c1"># Rest of the code follows the same pattern as your logistic regression</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
        
        <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
            <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span>
            <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
            <span class="n">cv</span><span class="o">=</span><span class="n">cv_folds</span><span class="p">,</span>
            <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span>
            <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        
        <span class="c1"># Log cross-validation results</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;cv_f1_mean&quot;</span><span class="p">,</span> <span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;cv_f1_std&quot;</span><span class="p">,</span> <span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        
        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;test_f1&quot;</span><span class="p">:</span> <span class="n">f1</span><span class="p">,</span>
            <span class="s2">&quot;true_negatives&quot;</span><span class="p">:</span> <span class="n">tn</span><span class="p">,</span>
            <span class="s2">&quot;false_positives&quot;</span><span class="p">:</span> <span class="n">fp</span><span class="p">,</span>
            <span class="s2">&quot;false_negatives&quot;</span><span class="p">:</span> <span class="n">fn</span><span class="p">,</span>
            <span class="s2">&quot;true_positives&quot;</span><span class="p">:</span> <span class="n">tp</span>
        <span class="p">}</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
        
        <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
            <span class="n">sk_model</span><span class="o">=</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span>
            <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;ridge_model&quot;</span><span class="p">,</span>
            <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
            <span class="n">input_example</span><span class="o">=</span><span class="n">X_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">registered_model_name</span><span class="o">=</span><span class="s2">&quot;RidgeClassifier&quot;</span>
        <span class="p">)</span>
        
        <span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training completed in </span><span class="si">{</span><span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best parameters: </span><span class="si">{</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best CV f1-score: </span><span class="si">{</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test f1-score: </span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Confusion Matrix:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TN: </span><span class="si">{</span><span class="n">tn</span><span class="si">}</span><span class="s2">, FP: </span><span class="si">{</span><span class="n">fp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FN: </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">, TP: </span><span class="si">{</span><span class="n">tp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span> <span class="n">f1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ridge_model</span> <span class="o">=</span> <span class="n">train_ridge_classifier</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 5 folds for each of 12 candidates, totalling 60 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/rutuja/miniconda3/envs/jupyterbook/lib/python3.10/site-packages/mlflow/types/utils.py:435: UserWarning: Hint: Inferred schema contains integer column(s). Integer columns in Python cannot represent missing values. If your input data contains missing values at inference time, it will be encoded as floats and will cause a schema enforcement error. The best way to avoid this problem is to infer the model schema based on a realistic data sample (training dataset) that includes missing values. Alternatively, you can declare integer columns as doubles (float64) whenever these columns may have missing values. See `Handling Integers With Missing Values &lt;https://www.mlflow.org/docs/latest/models.html#handling-integers-with-missing-values&gt;`_ for more details.
  warnings.warn(
Registered model &#39;RidgeClassifier&#39; already exists. Creating a new version of this model...
2024/12/22 17:42:21 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: RidgeClassifier, version 6
Created version &#39;6&#39; of model &#39;RidgeClassifier&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training completed in 26.72 seconds
Best parameters: {&#39;classifier__alpha&#39;: 100.0, &#39;classifier__class_weight&#39;: &#39;balanced&#39;, &#39;classifier__solver&#39;: &#39;auto&#39;}
Best CV f1-score: 0.6464
Test f1-score: 0.6184

Confusion Matrix:
TN: 741, FP: 294
FN: 75, TP: 299
üèÉ View run ridge_classifier at: https://dagshub.com/hrootscraft/my-book.mlflow/#/experiments/0/runs/d987da39a0c1498396bee34fa7ab6de2
üß™ View experiment at: https://dagshub.com/hrootscraft/my-book.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>

<span class="k">def</span> <span class="nf">train_random_forest_classifier</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">cv_folds</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trains and evaluates Random Forest Classifier with cross-validation and hyperparameter tuning</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;random_forest_classifier&quot;</span><span class="p">):</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">CustomPreprocessor</span><span class="p">()),</span>
            <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
        <span class="p">])</span>
        
        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span>
            <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
            <span class="s1">&#39;classifier__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
            <span class="s1">&#39;classifier__min_samples_leaf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="s1">&#39;classifier__class_weight&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;balanced&#39;</span><span class="p">]</span>
        <span class="p">}</span>
        
        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
            <span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span>
            <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span>
            <span class="n">cv</span><span class="o">=</span><span class="n">cv_folds</span><span class="p">,</span>
            <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        
        <span class="c1"># Rest follows the same pattern</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
        
        <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
            <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span>
            <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
            <span class="n">cv</span><span class="o">=</span><span class="n">cv_folds</span><span class="p">,</span>
            <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span>
            <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;cv_f1_mean&quot;</span><span class="p">,</span> <span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;cv_f1_std&quot;</span><span class="p">,</span> <span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        
        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;test_f1&quot;</span><span class="p">:</span> <span class="n">f1</span><span class="p">,</span>
            <span class="s2">&quot;true_negatives&quot;</span><span class="p">:</span> <span class="n">tn</span><span class="p">,</span>
            <span class="s2">&quot;false_positives&quot;</span><span class="p">:</span> <span class="n">fp</span><span class="p">,</span>
            <span class="s2">&quot;false_negatives&quot;</span><span class="p">:</span> <span class="n">fn</span><span class="p">,</span>
            <span class="s2">&quot;true_positives&quot;</span><span class="p">:</span> <span class="n">tp</span>
        <span class="p">}</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
        
        <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
            <span class="n">sk_model</span><span class="o">=</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span>
            <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;random_forest_model&quot;</span><span class="p">,</span>
            <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
            <span class="n">input_example</span><span class="o">=</span><span class="n">X_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">registered_model_name</span><span class="o">=</span><span class="s2">&quot;RandomForestClassifier&quot;</span>
        <span class="p">)</span>
        
        <span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training completed in </span><span class="si">{</span><span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best parameters: </span><span class="si">{</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best CV f1-score: </span><span class="si">{</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test f1-score: </span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Confusion Matrix:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TN: </span><span class="si">{</span><span class="n">tn</span><span class="si">}</span><span class="s2">, FP: </span><span class="si">{</span><span class="n">fp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FN: </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">, TP: </span><span class="si">{</span><span class="n">tp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span> <span class="n">f1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rndf_model</span> <span class="o">=</span> <span class="n">train_random_forest_classifier</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 5 folds for each of 108 candidates, totalling 540 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/rutuja/miniconda3/envs/jupyterbook/lib/python3.10/site-packages/mlflow/types/utils.py:435: UserWarning: Hint: Inferred schema contains integer column(s). Integer columns in Python cannot represent missing values. If your input data contains missing values at inference time, it will be encoded as floats and will cause a schema enforcement error. The best way to avoid this problem is to infer the model schema based on a realistic data sample (training dataset) that includes missing values. Alternatively, you can declare integer columns as doubles (float64) whenever these columns may have missing values. See `Handling Integers With Missing Values &lt;https://www.mlflow.org/docs/latest/models.html#handling-integers-with-missing-values&gt;`_ for more details.
  warnings.warn(
Registered model &#39;RandomForestClassifier&#39; already exists. Creating a new version of this model...
2024/12/22 17:47:49 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: RandomForestClassifier, version 2
Created version &#39;2&#39; of model &#39;RandomForestClassifier&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training completed in 327.47 seconds
Best parameters: {&#39;classifier__class_weight&#39;: &#39;balanced&#39;, &#39;classifier__max_depth&#39;: 10, &#39;classifier__min_samples_leaf&#39;: 4, &#39;classifier__min_samples_split&#39;: 10, &#39;classifier__n_estimators&#39;: 100}
Best CV f1-score: 0.6501
Test f1-score: 0.6317

Confusion Matrix:
TN: 796, FP: 239
FN: 91, TP: 283
üèÉ View run random_forest_classifier at: https://dagshub.com/hrootscraft/my-book.mlflow/#/experiments/0/runs/630bd76fb60c43e4a7f4322241ea58af
üß™ View experiment at: https://dagshub.com/hrootscraft/my-book.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="compare-f1-scores">
<h1>COMPARE F1 SCORES<a class="headerlink" href="#compare-f1-scores" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Train the models and get their F1 scores</span>
<span class="n">logistic_regression_model</span><span class="p">,</span> <span class="n">logistic_regression_f1</span> <span class="o">=</span> <span class="n">train_logistic_regression</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="n">ridge_classifier_model</span><span class="p">,</span> <span class="n">ridge_classifier_f1</span> <span class="o">=</span> <span class="n">train_ridge_classifier</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="n">random_forest_model</span><span class="p">,</span> <span class="n">random_forest_f1</span> <span class="o">=</span> <span class="n">train_random_forest_classifier</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

<span class="c1"># Store the F1 scores</span>
<span class="n">model_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Logistic Regression&#39;</span><span class="p">,</span> <span class="s1">&#39;Ridge Classifier&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">]</span>
<span class="n">f1_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">logistic_regression_f1</span><span class="p">,</span> <span class="n">ridge_classifier_f1</span><span class="p">,</span> <span class="n">random_forest_f1</span><span class="p">]</span>

<span class="c1"># Print the F1 scores for verification</span>
<span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">f1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">model_names</span><span class="p">,</span> <span class="n">f1_scores</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">: F1 Score = </span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 5 folds for each of 9 candidates, totalling 45 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/rutuja/miniconda3/envs/jupyterbook/lib/python3.10/site-packages/mlflow/types/utils.py:435: UserWarning: Hint: Inferred schema contains integer column(s). Integer columns in Python cannot represent missing values. If your input data contains missing values at inference time, it will be encoded as floats and will cause a schema enforcement error. The best way to avoid this problem is to infer the model schema based on a realistic data sample (training dataset) that includes missing values. Alternatively, you can declare integer columns as doubles (float64) whenever these columns may have missing values. See `Handling Integers With Missing Values &lt;https://www.mlflow.org/docs/latest/models.html#handling-integers-with-missing-values&gt;`_ for more details.
  warnings.warn(
Registered model &#39;LogisticRegression&#39; already exists. Creating a new version of this model...
2024/12/22 19:23:50 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: LogisticRegression, version 7
Created version &#39;7&#39; of model &#39;LogisticRegression&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training completed in 22.97 seconds
Best parameters: {&#39;classifier__C&#39;: 100.0, &#39;classifier__class_weight&#39;: &#39;balanced&#39;, &#39;classifier__solver&#39;: &#39;liblinear&#39;}
Best CV f1-score: 0.6498
Test f1-score: 0.6253

Confusion Matrix:
TN: 756, FP: 279
FN: 77, TP: 297
üèÉ View run logistic_regression at: https://dagshub.com/hrootscraft/my-book.mlflow/#/experiments/0/runs/43c5161c884d4d7388aa85dd2149d143
üß™ View experiment at: https://dagshub.com/hrootscraft/my-book.mlflow/#/experiments/0
Fitting 5 folds for each of 12 candidates, totalling 60 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/rutuja/miniconda3/envs/jupyterbook/lib/python3.10/site-packages/mlflow/types/utils.py:435: UserWarning: Hint: Inferred schema contains integer column(s). Integer columns in Python cannot represent missing values. If your input data contains missing values at inference time, it will be encoded as floats and will cause a schema enforcement error. The best way to avoid this problem is to infer the model schema based on a realistic data sample (training dataset) that includes missing values. Alternatively, you can declare integer columns as doubles (float64) whenever these columns may have missing values. See `Handling Integers With Missing Values &lt;https://www.mlflow.org/docs/latest/models.html#handling-integers-with-missing-values&gt;`_ for more details.
  warnings.warn(
Registered model &#39;RidgeClassifier&#39; already exists. Creating a new version of this model...
2024/12/22 19:24:18 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: RidgeClassifier, version 7
Created version &#39;7&#39; of model &#39;RidgeClassifier&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training completed in 27.04 seconds
Best parameters: {&#39;classifier__alpha&#39;: 100.0, &#39;classifier__class_weight&#39;: &#39;balanced&#39;, &#39;classifier__solver&#39;: &#39;auto&#39;}
Best CV f1-score: 0.6464
Test f1-score: 0.6184

Confusion Matrix:
TN: 741, FP: 294
FN: 75, TP: 299
üèÉ View run ridge_classifier at: https://dagshub.com/hrootscraft/my-book.mlflow/#/experiments/0/runs/a7a68902faa04fc5b297f8d92d50a0b4
üß™ View experiment at: https://dagshub.com/hrootscraft/my-book.mlflow/#/experiments/0
Fitting 5 folds for each of 108 candidates, totalling 540 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/rutuja/miniconda3/envs/jupyterbook/lib/python3.10/site-packages/mlflow/types/utils.py:435: UserWarning: Hint: Inferred schema contains integer column(s). Integer columns in Python cannot represent missing values. If your input data contains missing values at inference time, it will be encoded as floats and will cause a schema enforcement error. The best way to avoid this problem is to infer the model schema based on a realistic data sample (training dataset) that includes missing values. Alternatively, you can declare integer columns as doubles (float64) whenever these columns may have missing values. See `Handling Integers With Missing Values &lt;https://www.mlflow.org/docs/latest/models.html#handling-integers-with-missing-values&gt;`_ for more details.
  warnings.warn(
Registered model &#39;RandomForestClassifier&#39; already exists. Creating a new version of this model...
2024/12/22 19:29:25 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: RandomForestClassifier, version 3
Created version &#39;3&#39; of model &#39;RandomForestClassifier&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training completed in 305.56 seconds
Best parameters: {&#39;classifier__class_weight&#39;: &#39;balanced&#39;, &#39;classifier__max_depth&#39;: 10, &#39;classifier__min_samples_leaf&#39;: 4, &#39;classifier__min_samples_split&#39;: 10, &#39;classifier__n_estimators&#39;: 100}
Best CV f1-score: 0.6501
Test f1-score: 0.6317

Confusion Matrix:
TN: 796, FP: 239
FN: 91, TP: 283
üèÉ View run random_forest_classifier at: https://dagshub.com/hrootscraft/my-book.mlflow/#/experiments/0/runs/2b401a944e9944b3893bf1b977be7a2b
üß™ View experiment at: https://dagshub.com/hrootscraft/my-book.mlflow/#/experiments/0
Logistic Regression: F1 Score = 0.6253
Ridge Classifier: F1 Score = 0.6184
Random Forest: F1 Score = 0.6317
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Create a line plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model_names</span><span class="p">,</span> <span class="n">f1_scores</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Add annotations for each point</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f1_scores</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">model_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">score</span> <span class="o">+</span> <span class="mf">0.005</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Add titles and labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Comparison of F1 Scores for Different Models&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;F1 Score&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fbff1d48cd7ddc3b41ccfe82d1c7e59f4bf63ec64c0006650fa6eb49d21db318.png" src="../_images/fbff1d48cd7ddc3b41ccfe82d1c7e59f4bf63ec64c0006650fa6eb49d21db318.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="save-the-best-model">
<h1>SAVE THE BEST MODEL<a class="headerlink" href="#save-the-best-model" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span>

<span class="c1"># Save the trained model to a pickle file</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rndf_model</span><span class="p">,</span> <span class="s1">&#39;rndf_model.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">PicklingError</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">31</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">joblib</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1"># Save the trained model to a pickle file</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rndf_model</span><span class="p">,</span> <span class="s1">&#39;rndf_model.pkl&#39;</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/joblib/numpy_pickle.py:553,</span> in <span class="ni">dump</span><span class="nt">(value, filename, compress, protocol, cache_size)</span>
<span class="g g-Whitespace">    </span><span class="mi">551</span> <span class="k">elif</span> <span class="n">is_filename</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">552</span>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">553</span>         <span class="n">NumpyPickler</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">protocol</span><span class="p">)</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">554</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">555</span>     <span class="n">NumpyPickler</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">protocol</span><span class="p">)</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:487,</span> in <span class="ni">_Pickler.dump</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">485</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proto</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">486</span>     <span class="bp">self</span><span class="o">.</span><span class="n">framer</span><span class="o">.</span><span class="n">start_framing</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">487</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">488</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">STOP</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">489</span> <span class="bp">self</span><span class="o">.</span><span class="n">framer</span><span class="o">.</span><span class="n">end_framing</span><span class="p">()</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/joblib/numpy_pickle.py:355,</span> in <span class="ni">NumpyPickler.save</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">352</span>     <span class="n">wrapper</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">353</span>     <span class="k">return</span>
<span class="ne">--&gt; </span><span class="mi">355</span> <span class="k">return</span> <span class="n">Pickler</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:603,</span> in <span class="ni">_Pickler.save</span><span class="nt">(self, obj, save_persistent_id)</span>
<span class="g g-Whitespace">    </span><span class="mi">599</span>     <span class="k">raise</span> <span class="n">PicklingError</span><span class="p">(</span><span class="s2">&quot;Tuple returned by </span><span class="si">%s</span><span class="s2"> must have &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">600</span>                         <span class="s2">&quot;two to six elements&quot;</span> <span class="o">%</span> <span class="n">reduce</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">602</span> <span class="c1"># Save the reduce() output and finally memoize the object</span>
<span class="ne">--&gt; </span><span class="mi">603</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_reduce</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">rv</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:717,</span> in <span class="ni">_Pickler.save_reduce</span><span class="nt">(self, func, args, state, listitems, dictitems, state_setter, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">715</span> <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">716</span>     <span class="k">if</span> <span class="n">state_setter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">717</span>         <span class="n">save</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">718</span>         <span class="n">write</span><span class="p">(</span><span class="n">BUILD</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">719</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">720</span>         <span class="c1"># If a state_setter is specified, call it instead of load_build</span>
<span class="g g-Whitespace">    </span><span class="mi">721</span>         <span class="c1"># to update obj&#39;s with its previous state.</span>
<span class="g g-Whitespace">    </span><span class="mi">722</span>         <span class="c1"># First, push state_setter and its tuple of expected arguments</span>
<span class="g g-Whitespace">    </span><span class="mi">723</span>         <span class="c1"># (obj, state) onto the stack.</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/joblib/numpy_pickle.py:355,</span> in <span class="ni">NumpyPickler.save</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">352</span>     <span class="n">wrapper</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">353</span>     <span class="k">return</span>
<span class="ne">--&gt; </span><span class="mi">355</span> <span class="k">return</span> <span class="n">Pickler</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:560,</span> in <span class="ni">_Pickler.save</span><span class="nt">(self, obj, save_persistent_id)</span>
<span class="g g-Whitespace">    </span><span class="mi">558</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">559</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">560</span>     <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>  <span class="c1"># Call unbound method with explicit self</span>
<span class="g g-Whitespace">    </span><span class="mi">561</span>     <span class="k">return</span>
<span class="g g-Whitespace">    </span><span class="mi">563</span> <span class="c1"># Check private dispatch table if any, or else</span>
<span class="g g-Whitespace">    </span><span class="mi">564</span> <span class="c1"># copyreg.dispatch_table</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:972,</span> in <span class="ni">_Pickler.save_dict</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">969</span>     <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">MARK</span> <span class="o">+</span> <span class="n">DICT</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">971</span> <span class="bp">self</span><span class="o">.</span><span class="n">memoize</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">972</span> <span class="bp">self</span><span class="o">.</span><span class="n">_batch_setitems</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:998,</span> in <span class="ni">_Pickler._batch_setitems</span><span class="nt">(self, items)</span>
<span class="g g-Whitespace">    </span><span class="mi">996</span>     <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">997</span>         <span class="n">save</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">998</span>         <span class="n">save</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">999</span>     <span class="n">write</span><span class="p">(</span><span class="n">SETITEMS</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1000</span> <span class="k">elif</span> <span class="n">n</span><span class="p">:</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/joblib/numpy_pickle.py:355,</span> in <span class="ni">NumpyPickler.save</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">352</span>     <span class="n">wrapper</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">353</span>     <span class="k">return</span>
<span class="ne">--&gt; </span><span class="mi">355</span> <span class="k">return</span> <span class="n">Pickler</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:560,</span> in <span class="ni">_Pickler.save</span><span class="nt">(self, obj, save_persistent_id)</span>
<span class="g g-Whitespace">    </span><span class="mi">558</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">559</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">560</span>     <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>  <span class="c1"># Call unbound method with explicit self</span>
<span class="g g-Whitespace">    </span><span class="mi">561</span>     <span class="k">return</span>
<span class="g g-Whitespace">    </span><span class="mi">563</span> <span class="c1"># Check private dispatch table if any, or else</span>
<span class="g g-Whitespace">    </span><span class="mi">564</span> <span class="c1"># copyreg.dispatch_table</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:932,</span> in <span class="ni">_Pickler.save_list</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">929</span>     <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">MARK</span> <span class="o">+</span> <span class="n">LIST</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">931</span> <span class="bp">self</span><span class="o">.</span><span class="n">memoize</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">932</span> <span class="bp">self</span><span class="o">.</span><span class="n">_batch_appends</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:956,</span> in <span class="ni">_Pickler._batch_appends</span><span class="nt">(self, items)</span>
<span class="g g-Whitespace">    </span><span class="mi">954</span>     <span class="n">write</span><span class="p">(</span><span class="n">MARK</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">955</span>     <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">956</span>         <span class="n">save</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">957</span>     <span class="n">write</span><span class="p">(</span><span class="n">APPENDS</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">958</span> <span class="k">elif</span> <span class="n">n</span><span class="p">:</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/joblib/numpy_pickle.py:355,</span> in <span class="ni">NumpyPickler.save</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">352</span>     <span class="n">wrapper</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">353</span>     <span class="k">return</span>
<span class="ne">--&gt; </span><span class="mi">355</span> <span class="k">return</span> <span class="n">Pickler</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:560,</span> in <span class="ni">_Pickler.save</span><span class="nt">(self, obj, save_persistent_id)</span>
<span class="g g-Whitespace">    </span><span class="mi">558</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">559</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">560</span>     <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>  <span class="c1"># Call unbound method with explicit self</span>
<span class="g g-Whitespace">    </span><span class="mi">561</span>     <span class="k">return</span>
<span class="g g-Whitespace">    </span><span class="mi">563</span> <span class="c1"># Check private dispatch table if any, or else</span>
<span class="g g-Whitespace">    </span><span class="mi">564</span> <span class="c1"># copyreg.dispatch_table</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:887,</span> in <span class="ni">_Pickler.save_tuple</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">885</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">proto</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">886</span>     <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">887</span>         <span class="n">save</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">888</span>     <span class="c1"># Subtle.  Same as in the big comment below.</span>
<span class="g g-Whitespace">    </span><span class="mi">889</span>     <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="n">memo</span><span class="p">:</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/joblib/numpy_pickle.py:355,</span> in <span class="ni">NumpyPickler.save</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">352</span>     <span class="n">wrapper</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">353</span>     <span class="k">return</span>
<span class="ne">--&gt; </span><span class="mi">355</span> <span class="k">return</span> <span class="n">Pickler</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:603,</span> in <span class="ni">_Pickler.save</span><span class="nt">(self, obj, save_persistent_id)</span>
<span class="g g-Whitespace">    </span><span class="mi">599</span>     <span class="k">raise</span> <span class="n">PicklingError</span><span class="p">(</span><span class="s2">&quot;Tuple returned by </span><span class="si">%s</span><span class="s2"> must have &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">600</span>                         <span class="s2">&quot;two to six elements&quot;</span> <span class="o">%</span> <span class="n">reduce</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">602</span> <span class="c1"># Save the reduce() output and finally memoize the object</span>
<span class="ne">--&gt; </span><span class="mi">603</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_reduce</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">rv</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:687,</span> in <span class="ni">_Pickler.save_reduce</span><span class="nt">(self, func, args, state, listitems, dictitems, state_setter, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">684</span>     <span class="k">raise</span> <span class="n">PicklingError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">685</span>         <span class="s2">&quot;args[0] from __newobj__ args has the wrong class&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">686</span> <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="ne">--&gt; </span><span class="mi">687</span> <span class="n">save</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">688</span> <span class="n">save</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">689</span> <span class="n">write</span><span class="p">(</span><span class="n">NEWOBJ</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/joblib/numpy_pickle.py:355,</span> in <span class="ni">NumpyPickler.save</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">352</span>     <span class="n">wrapper</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">353</span>     <span class="k">return</span>
<span class="ne">--&gt; </span><span class="mi">355</span> <span class="k">return</span> <span class="n">Pickler</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:560,</span> in <span class="ni">_Pickler.save</span><span class="nt">(self, obj, save_persistent_id)</span>
<span class="g g-Whitespace">    </span><span class="mi">558</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">559</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">560</span>     <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>  <span class="c1"># Call unbound method with explicit self</span>
<span class="g g-Whitespace">    </span><span class="mi">561</span>     <span class="k">return</span>
<span class="g g-Whitespace">    </span><span class="mi">563</span> <span class="c1"># Check private dispatch table if any, or else</span>
<span class="g g-Whitespace">    </span><span class="mi">564</span> <span class="c1"># copyreg.dispatch_table</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:1129,</span> in <span class="ni">_Pickler.save_type</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">   </span><span class="mi">1127</span> <span class="k">elif</span> <span class="n">obj</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1128</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_reduce</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="p">(</span><span class="o">...</span><span class="p">,),</span> <span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1129</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_global</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:1076,</span> in <span class="ni">_Pickler.save_global</span><span class="nt">(self, obj, name)</span>
<span class="g g-Whitespace">   </span><span class="mi">1074</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1075</span>     <span class="k">if</span> <span class="n">obj2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1076</span>         <span class="k">raise</span> <span class="n">PicklingError</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1077</span>             <span class="s2">&quot;Can&#39;t pickle </span><span class="si">%r</span><span class="s2">: it&#39;s not the same object as </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
<span class="g g-Whitespace">   </span><span class="mi">1078</span>             <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">module_name</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">1080</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proto</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1081</span>     <span class="n">code</span> <span class="o">=</span> <span class="n">_extension_registry</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">module_name</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

<span class="ne">PicklingError</span>: Can&#39;t pickle &lt;class &#39;__main__.CustomPreprocessor&#39;&gt;: it&#39;s not the same object as __main__.CustomPreprocessor
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="use-fast-api-to-deploy-model">
<h1>USE FAST API TO DEPLOY MODEL<a class="headerlink" href="#use-fast-api-to-deploy-model" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Initialize FastAPI app</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="c1"># Load the saved model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;rndf_model.pkl&#39;</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/predict/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">features</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Endpoint to make predictions.</span>
<span class="sd">    :param features: List of input features for prediction.</span>
<span class="sd">    :return: Predicted class or probabilities.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert input features to a NumPy array</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">features</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Make prediction using the loaded model</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;prediction&quot;</span><span class="p">:</span> <span class="n">prediction</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">EOFError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">34</span><span class="p">],</span> <span class="n">line</span> <span class="mi">11</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="c1"># Load the saved model</span>
<span class="ne">---&gt; </span><span class="mi">11</span> <span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;rndf_model.pkl&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/predict/&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="k">async</span> <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">features</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span><span class="sd">     Endpoint to make predictions.</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span><span class="sd">     :param features: List of input features for prediction.</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span><span class="sd">     :return: Predicted class or probabilities.</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span><span class="sd">     &quot;&quot;&quot;</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/joblib/numpy_pickle.py:658,</span> in <span class="ni">load</span><span class="nt">(filename, mmap_mode)</span>
<span class="g g-Whitespace">    </span><span class="mi">652</span>             <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fobj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">653</span>                 <span class="c1"># if the returned file object is a string, this means we</span>
<span class="g g-Whitespace">    </span><span class="mi">654</span>                 <span class="c1"># try to load a pickle file generated with an version of</span>
<span class="g g-Whitespace">    </span><span class="mi">655</span>                 <span class="c1"># Joblib so we load it with joblib compatibility function.</span>
<span class="g g-Whitespace">    </span><span class="mi">656</span>                 <span class="k">return</span> <span class="n">load_compatibility</span><span class="p">(</span><span class="n">fobj</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">658</span>             <span class="n">obj</span> <span class="o">=</span> <span class="n">_unpickle</span><span class="p">(</span><span class="n">fobj</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mmap_mode</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">659</span> <span class="k">return</span> <span class="n">obj</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/joblib/numpy_pickle.py:577,</span> in <span class="ni">_unpickle</span><span class="nt">(fobj, filename, mmap_mode)</span>
<span class="g g-Whitespace">    </span><span class="mi">575</span> <span class="n">obj</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">576</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">577</span>     <span class="n">obj</span> <span class="o">=</span> <span class="n">unpickler</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">578</span>     <span class="k">if</span> <span class="n">unpickler</span><span class="o">.</span><span class="n">compat_mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">579</span>         <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The file &#39;</span><span class="si">%s</span><span class="s2">&#39; has been generated with a &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">580</span>                       <span class="s2">&quot;joblib version less than 0.10. &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">581</span>                       <span class="s2">&quot;Please regenerate this pickle file.&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">582</span>                       <span class="o">%</span> <span class="n">filename</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">583</span>                       <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/jupyterbook/lib/python3.10/pickle.py:1211,</span> in <span class="ni">_Unpickler.load</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1209</span> <span class="n">key</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1210</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1211</span>     <span class="k">raise</span> <span class="ne">EOFError</span>
<span class="g g-Whitespace">   </span><span class="mi">1212</span> <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">bytes_types</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1213</span> <span class="n">dispatch</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]](</span><span class="bp">self</span><span class="p">)</span>

<span class="ne">EOFError</span>: 
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./book"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="2.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">EDA - Exploratory Data Anlaysis</p>
      </div>
    </a>
    <a class="right-next"
       href="4.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Streamlit code</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">COMPARE F1 SCORES</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#save-the-best-model">SAVE THE BEST MODEL</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#use-fast-api-to-deploy-model">USE FAST API TO DEPLOY MODEL</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Rutuja Bhure
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>